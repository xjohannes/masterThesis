\documentclass[english]{ifimaster}
\usepackage[utf8]{inputenc}
\usepackage{babel,textcomp,csquotes,,varioref,graphicx}% ifikompendiumforside Remember to ads
\usepackage[T1]{fontenc}
\usepackage[hyphens]{url} % deler lange url-er

% biblatex-pakka med opsjoner
\usepackage[backend=biber, style=numeric-comp,%
defernumbers=true, style=authoryear, backref,sortcites]{biblatex}

% må opplyse om bib-filen
% ved flere bib-filer gjentas kommandoen
\addbibresource{bibliography.bib}

% denne kommandoen er for reftex som ikke forstår BibLaTeX
%\bibliography{referanser}

% noen mulige lokale biblatex tilpasninger
%\DefineBibliographyStrings{norsk}{%
%   urlseen={Sett: },
%   bibliography = {Bibliografi},
%   references = {Referanser},
%   editor = {redaktør},
%   translator={oversetter},
   %page={side},
   %pages={sidene},
%   and={og}
%}
%\reg{fig:picture8}
% /begin{figure}[htbp]
%\centering
%\includegraphics[scale=0.6]{imgName.png}
%\caption{Bla bla}
%\label{fig:picture8}
%\end{figure}

\DeclareFieldFormat{url}{\url{#1}} % fjerner hardkodet "URL: " foran url

\DeclareUrlCommand\url{\def\UrlLeft{\newline}\def\UrlRight{\newline}%
\urlstyle{sf}} % setter inn passende linjeskift

% biblatex anbefaler at hyperref blir lastet inn etter biblatex
\usepackage{hyperref}

\title{Applying browser side state management on server rendered web pages}
\subtitle{} 
% Sett inn ditt eget navn her:
\author{Johannes Akse}
\date{2016}

\begin{document}
%\ififorside
\maketitle{}
\pagenumbering{roman}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Abstract %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter*{Abstract}

%Example of siting: their jobs, rather than the programmer's \parencite {shneiderman1983}\parencite{stephenson1999,hutchins1986},.
\tableofcontents
\nocite{*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Preface %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter*{Preface}
"Personal" motivation for writing the thesis, the changing of focus from wizard to state (basic/advanced) and lastly adding history functionality. Write the main portion of the thesis as if history management was a specification all the way or integrating the addition of this in the introduction?

These features, even though not part of the original requirement specifications for this master thesis, has after implementation been received with some expectations from in-house users of the system. 

No expert supervisor on javaScript and main supervisor on paternity leave I have been quite alone when making design decisions. 

Open the eyes of the university for JavaScript.
\chapter*{Notes. Must be deleted upon due date}

   

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Introduction %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Introduction}
\pagenumbering{arabic}
This thesis is all about state and how to manage state in a browser.
The intention of the web to augment the human brain, From Doug Engelbart to Sir Tim Bernes-Lee, has been leading bla bla. Thy hyperbrowsers intention is to provide the possibility to help researchers do research(Howard Rheingold). The galaxy platform facilitates sharing results, my app gives the opportunity to share research questions.  
\section{Motivation}%Move to preface?
%Why there is a need for the product I have made


\section{Goals}
%(Entice the reader, what are they about to spend time reading, why would they?)
My first goal is to show why implementing a simple feature like a button changing between basic and advanced mode, even though sounding like an easy task, is far from trivial when done on an already existing web page. 

Secondly I show that the underlying structure needed to build such a seemingly simple feature facilitates faster and easier development of other state dependent functionality.

The programatic contribution to the thesis has two parts:
\begin{itemize}
  \item Providing a generic basic/advanced button to accomodate state changes for all state dependent functionality.
  \item Handling state within tools. 
\end{itemize}


\section{Overview}
\subsection{Background}
After introducing the main topics of the thesis, this introduction, I explain what "the Genomic Hyperbrowser" is and discuss some of its reported problems concerning usability. The g-suite project addresses some of these problems but does so server side. The program behind this thesis does so client side and has been included in the g-suite.

The next few section will discuss different aspects of state management. 

Lastly I give the reader a short introduction to certain aspects of Javascript. I do this to introduce an ongoing discussion and of which I will join in the thesis discussion.
\subsection{Methodology}
This section will concern explanations on test driven development an module based implementation provided by browserify.
\subsection{Development}
In this section I will discuss the important details of the implementation of the program under scrutiny. There will be no discussion in this section only an account on what has actually been done.

\subsection{Discussion}
Here I will pick up the discussion from the background concerning state management and bring in the insight gatherd from the developement.
\section{Limitations/boundaries of the thesis (avgrensning)}

\section{Development in a real time setting}




\section{Requirement specifications}
Users expect certain behaviour from a web site \parencite{mikowski}.
\subsection{A use case}




\section{Challenges}

\section{Problem statement}
How to apply state management for predefined server rendered pages in a web browser.

\section{Terminology}
\subsection{Acronyms}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Background %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Background}
\section{A real world use case}
\subsection{The Genomic HyperBrowser}
\subsection{the G-suite - A need to simplify the UI}
\section{State management}
\subsection{What is state?}

As the Internet has matured, we, the users of the World Wide Web, have started to expect certain behaviour from a web page\parencite[p.85]{mikowski}. Whether the web site is about displaying dynamically rendered news articles or, as is the case of "The Genomic HyperBrowser", doing statistical analyzes on a genome, the users expect to be able to use the built in actions most browsers provide. Going back and forth using the navigation arrows on the top left side of the page or bookmarking a page for later reference or even sending a link to a friend or colleague is build in functionality I claim every site should strive to provide for its users.\newline
\noindent Up til now this has not been the case for the Genomic HyperBrowser. To be fair, going back and forth is features that has already been offered by the HyperBrowser. The fact that every selection done in a tool has re-render the mainFrame, that is gotten a whole new page from the server, the native functionality of the browser still works as expected. Saving the selections or sending a specific selection to a co-worker or other scientist has however not been possible.

State

\subsection{Why is state important?}

\subsection{The statelessness of REST}

\subsection{State management in web clients}
\paragraph{Storing state in the browser}

\section{Anticipated behavior in a web application}

\section{The MVC controversy}
\section{Location hash or models as driving application state}

\section{Communicating with the DOM}

\section{Strictly objects vs class structures} (Discussion?)
\subsection{ECMA 5 vs ECMA 6} (Discussion?)

\section{Using third party libraries or design from scratch?} (Discussion?)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Methodology %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Methodology}
Why local testing has been crucial to development 

\section{Behavior driven development}
Find source.

\subsection{Jasmine}
Using Jasmine as integration testing tool

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Development %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Development}
In this chapter I describe what have been done. I also try to reason why I have done as I have. To let the reader get a full understanding of the following sections I start of by giving a brief overview of JavaScript.

\section{JavaScript}

\begin{quotation}
\noindent JavaScript is ”[…] clearly a grossly substandard language by modern
standards and thus can be legitimately described as a toy language.” —
\parencite{arno}
\end{quotation}

Even though some people still have problems recognising JavaScript as more than a toy programing language JavaScript has had a rapid evolution the last 10 years. The emergence of  big JavaScript libraries and frameworks like Backbonejs and Angularjs can be seen as a direct consequence of what has been coined the second browser war\parencite{Yule2013}. Especially after Google launched their Chrome browser in 2008 and the JavaScript runtime Nodejs was build on top of chromes V8 engine, the speed of interpreting JavaScript has increased enormously. Other JavaScript engines now uses dynamic compilation, also called "Just in time" technology and the V8 compiles directly to byte code which make them even faster\parencite{anand}. JavaScript is also the standard programing language of the "World Wide Web"\parencite[p. 1]{flanagan} and is thereby one of the most used programing languages.


\section{The web client}
"The web browser is perhaps the most widely used software application in history. It has evolved significantly over the past twenty years; today, web browsers run on diverse types of hardware, from cell phones and tablet PCs to desktop computers"\parencite[p. 2]{gross}. We even have iWatches and Google glasses. The web client is no longer just a reader of static information browsing interlinked web pages. Now it is better described as a simplified OS\parencite[p.310]{flanagan}. The browsers provide ways to organize web documents and web applications in folder structures. As is the case for the current state app, it allows for organization of statistical analysis questions and hypothesises. It also allows for running multiple discrete applications much like an OS. The state app consists of two distinct applications, one that handles tool state and one that synchronizes mode between frames. Thirdly web browsers define low-level API's for activities such as networking and saving data. 

The Genomic HyperBrowser use some of these new technologies. It does rely on jQuerys Ajax suite to do some of the communication with the server. They have even started using one of the HTML5 specifications, the localStorage API, which they have entrusted to a third party plugin, JStorage. 

While utilizing new web standards on some parts of the page they also rely heavily on the somewhat discouraged technique of using iFrames for separating content on a page..%Why is this discouraged. Source?% They could have used components, widgets and plain css.
The usage of iFrames stems from the fact that the HyperBrowser is an extension of an other open source, web-based platform for data intensive biomedical research, namely the Galaxy platform and is by that dependent on how the Galaxy project was originally implemented. The consequences of having to deal with iFrames for the state app will be discussed later in this chapter but will here only function as an introduction to .

As might be demanded of post modern information technology the web client can mash together information from several different sources and by that create information and express novel ideas to the users/world. The HyperBrowsers new state functionality utilizes the web client letting scientists share their scientific questions and hypothesises which not only facilitate reproducibility but also promote augmenting the human intellect. Aka the series silicon valley - All apps try to make the world a better place.

For a program to manage state within a browser context it needs some way to interact with the HTML elements displayed on the page. The standard programming language for all modern browsers, Javascript, provides such and entry point. When the server returns the requested page the browser creates a plain javascript object, called the document object, and uses it as the root of a tree like structure. It then parses the received HTML. For every HTML element it creates a responding javascript object and adds it to the document tree. This tree is often referred to as the DOM. All of these javascript objects have fields that correspond to all the HTML element attributes. The elements most interesting to the discussions of this thesis are the iFrame element and the form element. These have such a central place in the development that they deserve a whole section each. For now  

\subsection{JQuery}
One of the challenges of writing nontrivial JavaScript client-side programs is to ensure they run correctly on the wide variety of different browser implementations we have to day\parencite[p. 325]{flanagan}. One example of the discrepancy between browser vendors JavaScript implementation is Microsofts reluctance to implement the DOM Level 2 Events specification which is The World Wide Web Consortium (W3C) recommended standard\parencite{w3c}. This specification includes crucial functionality such as the AddEventListener which is paramount to most interaction with a web page. To accommodate for these differences the programmer need to write a lot of extra boilerplate code if the use of natively supported JavaScript is important. What many chooses to do in stead, is to use an external, third-party library to query the DOM. 

With the plethora of JavaScript libraries available, jQuery is the most widely used according to the libscore search engine\parencite{infoWorld}. The ease of use and the great amount of functionality besides querying the DOM, most significantly their handling of Ajax calls has been the leading reasons why I have chosen jQuery over other libraries such as Motools and Dojo. 

Since the release of Internet Explorer 9, however, Microsoft finally decided to implement the decade old W3C standardizations and as a result most of the browser differences disappeared. One might think that this would be the end of the widespread use of JavaScript libraries but that has not been the case. A quick google search on jQuery usage statistics showed that between 60 and 70\% of the top 10k web sites still rely on jQuery \parencite{jQueryWiki} \parencite{jQueryW3Tech}\parencite{builtWith}. A natural explanation for the continuing popularity of jQuery is the need for many web sites to provide satisfactory service to legacy browsers such as Microsofts Internet Explorer 8 and beyond. This also applies to The HyperBrowser. The goal of being a service available to the public leaves no choice but to cater for the communities where replacing the computer every second new release of software is unaffordable. 

%What is jQuery? And why is this important for this thesis?

%css selectors
\subsection{The iFrame}
pros and cons. Consequences for the state app.k


\subsection{Thr URI and the location object}
\section{Design principles}
Javascript as spagetti.
\section{Modularity}
Encapsulation.
Modules

npm
browserify

\section{Design choices}

At the core of the program lies two well known design patterns: "The Model View Controller" might better be described as an architecture than and design pattern as discussed in the previous chapter. "The Observer pattern" on the other hand is a fully fledged classical design pattern.

Design choices also comprise of other constructs than pure patterns.


For modularity and encapsulation. (Discussion?)
\subsection{Browserify, taking Nodejs NPM module loading technology to the browser}

the overall structure of the state app.
pdf overview of object interaction/object diagram

\subsection{Classical design patterns}
Classical design patterns carry a double meaning. On the one hand "classical" design patterns refer to well established and thoroughly tested coding practices\parencite[p. 12]{gamma}. On the other hand "classical" design patterns refer to object-oriented programming where classes act as a template for object production\parencite[p. 115]{stefanov}. The "classical" and highly influential book "Design patterns: Elements of Reusable Object-Oriented Software" suggests as a starting point twenty three named object oriented design patterns. The "main goals of the book was to capture and record experience on design in a form that people can use effectively"\parencite[p. 12]{gamma}. Good design patterns with thereto thoughtful and descriptive names can both establish a vocabulary that can ease communication between experienced programmers, assist in faster comprehension of object oriented programming principles and function as cognitive aids for junior programmers and programming students.

\subsubsection{The observer pattern.}
The intent of the Observer pattern is to “define a one-to-many dependency between objects so that when one object changes state, all its dependents are notified and updated automatically”\parencite[p. 9]{gamma}. It is often described as a publish-subscriber relationship where the observers subscribe to events and the observable "publishes" events to the subscribers letting them know there is a new "publication" ready. The "publication" can for instance be a state change in the publisher or other related code. Following the publisher-subscriber metaphor a little further; when a newspaper is ready for publication there has usually been two ways for news readers to obtain an exemplar of the paper, one by going to a news stand buying it there, the other to subscribe and thereby get it delivered to the front door\parencite[p. 171-174]{stefanov}.

As goes for all design patterns, every implementation needs to tweak the original to fit the problem at hand. When used with "classical" programming languages this notion of a subscriber is somewhat misleading. Its more often implemented as a notification system where the observers gets notified and only then decides if they want or need the update. Usually the observable maintain a list or so of pointers to the observers and run through this list calling the observers notify method. The observers then call the update method of the observable when and if needed.

"Classical" object-oriented programming languages provide constructs like interfaces, that acts as contracts guaranteeing that certain methods exist. Interfaces does not contain any code. Other often completely different classes implement the interface. This is how the observables can maintain a unified list of observers and at the same time let the observers implementation be heterogeneous.They don't need to extend the same class as long as they implement the methods described in the observer interface. 

Since JavaScript is a loosely typed programming language, meaning that it does not contain classes in the real sense and thereby do not differentiate between types of objects, it does not provide the programmer with interface like constructs.  

\begin{quotation}
“The thing about design patterns in relation to JavaScript is that, although language-independent, the design patterns were mostly studied from the perspective of strongly typed languages, such as C++ and Java. Sometimes it doesn’t necessarily make sense to apply them verbatim in a loosely typed dynamic language such as JavaScript. Sometimes these patterns are workarounds that deal with the strongly typed nature of the languages and the class-based inheritance. In JavaScript there might be simpler alternatives” \parencite[s. 2]{stefanov}.
\end{quotation}

The dispatcher object in the state app is an example of an observable but implemented differently from the "classical" approach. The dispatcher will be discussed in due time. As for now it suffices to say that instead of maintaining a list of interface pointers to observers, the observers, when registering to the observable, leave a pointer directly to the function that needs to be called. When the dispatcher is prompted to trigger or dispatch an event it goes through the lists of functions and calls them directly without the need of a specific type interface. An attached context pointer is registered together with the function and it is this context pointer that represents the object the functions "this" keyword points to.

Should I explain the use of "this" here or when talking about the prototype chain. The latter. But may be this is a good place to start the focus on the code

\subsection{}
\section{Building blocks / Objects}
\subsection{Main}
\subsubsection{ModeApp}
\subsubsection{ToolApp}

\subsection{Prototypes}
\subsubsection{Model prototype}
\subsubsection{View prototype}
\subsubsection{Controller prototype}
\subsubsection{History prototype}
\subsubsection{Dispatcher prototype}
\subsubsection{Dispatcher prototype}
The naming is not 100 \% consistent with the metaphor of a dispatcher. 

The Dispatcher prototype is inspired by the Observer pattern. It provides the methods for listening to dispatched events, for triggering events and for stop listening to events. It is a utility object that all the models, views, controllers and the history object listens to. The events are then dispatched to all listening objects. As discussed in the opening of the chapter the implementation for the state application has some differences from the observer pattern described by Gamma et al. Instead of registering with a pointer to an object such that the observable can iterate the list of object pointers and call their update method, the observers leaves with the observable the function to be called. It also leaves a pointer to it self. This is possible because functions in JavaScript are considered as objects and as any objects functions can have methods.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Discussion %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Discussion}
\section{Single page application on top of server heavy page - A hack?}
\section{Specific or broad approach}
\subsubsection{Code for the future ie pushState} {}
\subsubsection{Both setHistory and changeHistory} {}
 - More work. More mess.
 - Faster refactoring when new specifications
\subsubsection{uriAnchor vs. own development} 
\subsubsection{How to handle bugs in third party plugins?} 
\subsubsection{Using framework or library vs creating from scratchd}  (Introduced in the background).
\subsubsection{Local storage vs simple storage} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Conclusion %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Conclusion}

\section{Thoughts on future development}



\newpage
% The headline of the bibliography (the document class article)
\renewcommand{\refname}{Bibliography}

% redefiner \bibname ved bruk av dokumentklassen book

% Litteraturlista inn i innholdsfortegnelsen
\addcontentsline{toc}{section}{\refname}

\printbibheading
\printbibliography[type=book, title={Books}]
\printbibliography[type=article, title={Articles}]
\printbibliography[type=manual, title={Manuals}]
\printbibliography[nottype=book, nottype=article,%
nottype=manual, title={Other documents}]

\end{document}

 